# Техническое задание (ТЗ/Technical Specification)
## Локальный мессенджер для образовательных учреждений

**Версия документа:** 1.0 (фактическая)  
**Дата:** 2026  
**Автор:** Юхин Лавр Юрьевич/21ИС-24  
**Статус:** Учебный проект (реализован)

---

## 1. Общие сведения

### 1.1. Наименование системы
**Полное наименование:** Local Messenger - Система локального обмена сообщениями  
**Краткое наименование:** LMessenger  
**Кодовое наименование:** EduChat

### 1.2. Основание для разработки
Учебный проект по дисциплине "Программная инженерия" для демонстрации навыков разработки клиент-серверных приложений.

### 1.3. Назначение разработки
Создание рабочего прототипа мессенджера для локальной сети с целью изучения:
- Клиент-серверной архитектуры
- REST API разработки (FastAPI)
- Графических интерфейсов (PyQt5)
- Real-time коммуникации (WebSocket)
- Аутентификации и авторизации (JWT)

---

## 2. Архитектурные решения (фактические)

### 2.1. Общая архитектура системы
```
┌─────────────────────────────────────────────────────────┐
│                   Локальная сеть учреждения               │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────┐                 ┌──────────────────┐ │
│  │   Клиент 1   │◄──HTTP/WS──────►│     Сервер       │ │
│  │  (PyQt5)     │                 │    (FastAPI)     │ │
│  └──────────────┘                 │  ┌────────────┐  │ │
│                                   │  │ SQLite БД  │  │ │
│  ┌──────────────┐                 │  └────────────┘  │ │
│  │   Клиент 2   │◄──HTTP/WS──────►│  ┌────────────┐  │ │
│  │  (PyQt5)     │                 │  │ WebSocket  │  │ │
│  └──────────────┘                 │  │  Manager   │  │ │
│                                   │  └────────────┘  │ │
│                                   └──────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 2.2. Компонентная архитектура (реальная)

#### Клиентская часть (PyQt5):
```
┌─────────────────────────────────────────┐
│            Клиентское приложение         │
├─────────────────────────────────────────┤
│  ┌──────────────────────────────────┐  │
│  │         UI Layer (PyQt5)         │  │
│  │  • MainWindow - главное окно     │  │
│  │  • ChatWidget - виджет чата      │  │
│  │  • LoginDialog - окно входа      │  │
│  └──────────────────────────────────┘  │
│                   │                     │
│  ┌──────────────────────────────────┐  │
│  │      Business Logic Layer        │  │
│  │  • Message - модель сообщений    │  │
│  │  • WebSocketClient - соединение  │  │
│  └──────────────────────────────────┘  │
│                   │                     │
│  ┌──────────────────────────────────┐  │
│  │       Network Layer              │  │
│  │  • HTTP клиент (requests)        │  │
│  │  • WebSocket клиент              │  │
│  │  • Таймеры обновления (QTimer)   │  │
│  └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

#### Серверная часть (FastAPI):
```
┌─────────────────────────────────────────┐
│             Серверное приложение         │
├─────────────────────────────────────────┤
│  ┌──────────────────────────────────┐  │
│  │         API Layer (FastAPI)      │  │
│  │  • /auth - аутентификация        │  │
│  │  • /messages - сообщения         │  │
│  │  • /users - пользователи         │  │
│  │  • /admin - администрирование    │  │
│  │  • /ws - WebSocket endpoint      │  │
│  └──────────────────────────────────┘  │
│                   │                     │
│  ┌──────────────────────────────────┐  │
│  │      Business Logic Layer        │  │
│  │  • UserModel - модель пользователя│ │
│  │  • MessageModel - модель сообщений│ │
│  └──────────────────────────────────┘  │
│                   │                     │
│  ┌──────────────────────────────────┐  │
│  │       Data Access Layer          │  │
│  │  • SQLite Database               │  │
│  │  • CRUD операции                 │  │
│  └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

### 2.3. Структура базы данных (фактическая)

```sql
-- Таблица пользователей
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    is_online BOOLEAN DEFAULT FALSE,
    last_seen DATETIME,
    status TEXT DEFAULT 'offline',
    is_admin BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Таблица сообщений
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sender_id INTEGER NOT NULL,
    receiver_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    message_type TEXT DEFAULT 'text',
    file_data TEXT,  -- base64 encoded image data
    is_read BOOLEAN DEFAULT FALSE,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (sender_id) REFERENCES users (id),
    FOREIGN KEY (receiver_id) REFERENCES users (id)
);
```

---

## 3. Технологический стек (фактический)

### 3.1. Серверная часть (Backend)
| Компонент | Технология | Версия | Назначение |
|-----------|------------|---------|------------|
| **Фреймворк** | FastAPI | 0.104+ | REST API, WebSocket |
| **Язык** | Python | 3.8+ | Основной язык разработки |
| **База данных** | SQLite | 3.35+ | Локальное хранение данных |
| **Аутентификация** | JWT (PyJWT) | 2.8+ | Токенная аутентификация |
| **Хеширование** | bcrypt | 4.0+ | Безопасное хранение паролей |
| **Веб-сервер** | Uvicorn | 0.24+ | ASGI сервер для FastAPI |
| **WebSocket** | websockets | 12.0+ | Real-time уведомления |

### 3.2. Клиентская часть (Frontend)
| Компонент | Технология | Версия | Назначение |
|-----------|------------|---------|------------|
| **GUI Framework** | PyQt5 | 5.15+ | Графический интерфейс |
| **Язык** | Python | 3.8+ | Основной язык разработки |
| **HTTP клиент** | requests | 2.31+ | HTTP запросы к API |
| **WebSocket клиент** | websockets | 12.0+ | Real-time соединение |
| **Base64 кодирование** | base64 | стандарт | Кодирование изображений |
| **Временные файлы** | tempfile | стандарт | Временное хранение изображений |

### 3.3. Структура проекта (фактическая)
```
local_messenger/
├── client/                    # Клиентская часть
│   ├── ui/                   # Пользовательский интерфейс
│   │   ├── main_window.py    # Главное окно
│   │   ├── chat_widget.py    # Виджет чата
│   │   └── login_dialog.py   # Окно входа
│   ├── models/              # Модели данных
│   │   ├── message.py       # Модель сообщения
│   │   └── user.py          # Модель пользователя
│   ├── network/             # Сетевой слой
│   │   └── websocket_client.py
│   ├── config.py            # Конфигурация
│   └── main.py              # Точка входа
│
├── server/                   # Серверная часть
│   ├── routers/             # Маршруты API
│   │   ├── auth.py
│   │   ├── messages.py
│   │   ├── users.py
│   │   └── admin.py
│   ├── database/            # Работа с БД
│   │   ├── db.py
│   │   ├── user_model.py
│   │   └── message_model.py
│   ├── schemas/             # Pydantic схемы
│   │   ├── user.py
│   │   └── message.py
│   ├── dependencies.py      # Зависимости
│   ├── websocket_manager.py
│   └── main.py             # Точка входа
```

---

## 4. Требования к оборудованию (реалистичные)

### 4.1. Требования к серверу (минимальные)
| Компонент | Требования | Примечания |
|-----------|------------|------------|
| **Процессор** | 1 ядро, 1 ГГц | Для учебного использования |
| **Оперативная память** | 512 МБ | Для работы сервера и БД |
| **Жесткий диск** | 100 МБ | Для БД, логов, приложения |
| **Сетевая карта** | 100 Мбит/с | Ethernet, Wi-Fi |
| **Операционная система** | Windows 10/11, Linux | Любая с Python 3.8+ |

### 4.2. Требования к клиентским машинам
| Компонент | Требования | Примечания |
|-----------|------------|------------|
| **Процессор** | 1 ядро, 1 ГГц | Совместимый с Python 3.8 |
| **Оперативная память** | 256 МБ | Для работы клиентского приложения |
| **Дисковое пространство** | 50 МБ | Для установки приложения |
| **Экран** | 1024x768 | Минимальное разрешение для интерфейса |
| **Сетевая карта** | 100 Мбит/с | Подключение к локальной сети |
| **Операционная система** | Windows 10/11, Linux | С поддержкой PyQt5 |

### 4.3. Сетевые требования (фактические)
```
Топология:
   Образовательное учреждение
       │
       └── Подсеть (например, 192.168.0.0/24)
           ├── Сервер LMessenger (статический IP, например 192.168.0.100)
           ├── Клиент 1
           ├── Клиент 2
           └── Клиент N

Требования:
   1. Статический IP адрес для сервера
   2. Открытый порт 8000/TCP (HTTP + WebSocket)
   3. Все клиенты в одной подсети с сервером
   4. Нет блокировки порта 8000 локальным фаерволом
```

---

## 5. Интерфейсы и протоколы (фактические)

### 5.1. REST API интерфейсы

#### Базовый URL:
```
http://{server_ip}:8000
```

#### Endpoints аутентификации:
```http
POST /auth/register
Content-Type: application/json
{
  "username": "string",
  "password": "string"
}

POST /auth/login
Content-Type: application/json
{
  "username": "string",
  "password": "string"
}
Response: {"access_token": "jwt_token", "token_type": "bearer"}
```

#### Endpoints сообщений:
```http
GET /messages?contact_id={int}&limit={int}
Authorization: Bearer {token}

POST /messages
Authorization: Bearer {token}
Content-Type: application/json
{
  "content": "string",
  "receiver_id": int,
  "message_type": "text|image",
  "file_data": "base64_string"  # для изображений
}

DELETE /messages/{message_id}
Authorization: Bearer {token}
```

#### Endpoints пользователей:
```http
GET /users
Authorization: Bearer {token}

GET /users/me
Authorization: Bearer {token}
```

#### Endpoints администратора:
```http
GET /admin/all-messages
Authorization: Bearer {token}

GET /admin/all-users
Authorization: Bearer {token}
```

### 5.2. WebSocket интерфейс

#### Подключение:
```
ws://{server_ip}:8000/ws/{user_id}
```

#### Сообщения WebSocket:

**Входящие сообщения (от сервера):**
```json
{
  "type": "new_message",
  "message": {
    "id": 123,
    "sender_id": 1,
    "receiver_id": 2,
    "content": "Привет!",
    "timestamp": "2024-01-15T10:30:00",
    "message_type": "text"
  }
}
```

```json
{
  "type": "message_deleted",
  "message_id": 123,
  "deleted_by": 1
}
```

#### Keep-alive механизм:
```json
Клиент → Сервер: "ping"
Сервер → Клиент: "pong"
```

### 5.3. Интерфейсы клиентского приложения

#### Графический интерфейс:

**Главное окно (MainWindow):**
```
┌─────────────────────────────────────────┐
│ Local Messenger                    [_] [□] [X]│
├─────────────────┬───────────────────────┤
│   Контакты      │                       │
│   ┌──────────┐  │    Чат с: User2       │
│   │ 🟢 User1 │  │   ┌────────────────┐  │
│   │ ⚫ User3 │  │   │ 14:30 User2:    │  │
│   │ 🟢 User2 │  │   │ Привет!         │  │
│   │          │  │   │                 │  │
│   │          │  │   │ 14:31 Вы:       │  │
│   └──────────┘  │   │ Как дела?       │  │
│                 │   └────────────────┘  │
│                 │   ┌────────────────┐  │
│                 │   │ [Сообщение...]   │  │
│                 │   └────────────────┘  │
│                 │   [📎] [Отправить]    │  │
└─────────────────┴───────────────────────┘
```

**Окно входа (LoginDialog):**
```
┌─────────────────────────┐
│        Вход            │
├─────────────────────────┤
│ Имя пользователя:      │
│ [__________________]   │
│                        │
│ Пароль:                │
│ [__________________]   │
│                        │
│ [ Войти ] [Регистрация]│
└─────────────────────────┘
```

#### Программные интерфейсы:

**Класс ChatWidget (основной):**
```python
class ChatWidget(QWidget):
    def __init__(self, auth_token, current_user, contact):
        # Инициализация чата с конкретным контактом
    
    def send_message(self):
        # Отправка текстового сообщения
    
    def send_file(self):
        # Отправка файла/изображения (кнопка 📎)
    
    def delete_message(self, message_id):
        # Удаление сообщения (требует ввода ID)
    
    def load_messages(self):
        # Загрузка истории сообщений
```

**Класс Message (модель данных):**
```python
class Message:
    def __init__(self, message_id, sender_id, receiver_id, 
                 content, timestamp, message_type="text", 
                 file_data=None):
        # Модель сообщения
    
    def is_outgoing(self, current_user_id):
        # Проверка, является ли сообщение исходящим
    
    def get_formatted_time(self):
        # Форматирование времени для отображения (ЧЧ:ММ)
```

---

## 6. Требования к безопасности (реализованные)

### 6.1. Аутентификация и авторизация
1. **JWT токены** с временем жизни 24 часа
2. **Хеширование паролей** алгоритмом bcrypt
3. **Проверка прав** на уровне endpoints
4. **Автоматический логаут** при истечении токена (на клиенте)

### 6.2. Защита данных
1. **SQL инъекции:** Параметризованные запросы через SQLite
2. **XSS атаки:** HTML не обрабатывается, отображается как текст
3. **CSRF:** Использование JWT вместо сессий
4. **Перехват трафика:** Локальная сеть, рекомендуется изолированная среда

### 6.3. Конфиденциальность
1. **Пароли** никогда не передаются в открытом виде
2. **Изображения** передаются в base64 кодировке
3. **Личные данные** не передаются третьим лицам
4. **Логи** не содержат чувствительной информации

---

## 7. Требования к производительности (реалистичные)

### 7.1. Время отклика (ожидаемое):
| Операция | Ожидаемое время | Примечания |
|----------|----------------|------------|
| Отправка текстового сообщения | < 500 мс | В локальной сети |
| Получение сообщения (WebSocket) | < 100 мс | При стабильном соединении |
| Загрузка списка контактов | < 200 мс | 10-50 пользователей |
| Загрузка истории сообщений (100 шт) | < 1000 мс | Из SQLite БД |
| Отправка изображения (1 МБ) | < 2000 мс | Зависит от сети |

### 7.2. Нагрузочные характеристики (учебные):
| Параметр | Значение | Примечания |
|----------|----------|------------|
| Максимальное количество одновременных пользователей | 10-20 | Учебный проект |
| Максимальное количество сообщений в минуту | 100 | Для всех пользователей |
| Максимальный размер файла | 10 МБ | Практическое ограничение |
| Время бесперебойной работы | В учебное время | Не 24/7 |

---

## 8. Ограничения системы (фактические)

### 8.1. Технические ограничения
1. **Работа только в локальной сети** - нет поддержки интернета
2. **Нет NAT traversal** - только одна подсеть
3. **Максимальный размер БД:** ограничен дисковым пространством
4. **Нет репликации данных** - один сервер, одна БД

### 8.2. Функциональные ограничения
1. **Нет групповых чатов** - только индивидуальная переписка
2. **Нет голосовых/видеозвонков** - только текст и изображения
3. **Нет облачной синхронизации** - история только на локальном сервере
4. **Нет мобильного приложения** - только десктоп

### 8.3. Ограничения интерфейса
1. **Удаление по ID** - нужно вручную вводить ID сообщения
2. **Фиксированный размер изображений** - 200px ширина
3. **Нет уведомлений** - нужно следить за чатом
4. **Нет поиска по истории** - только просмотр

---

## 9. Критерии приемки (учебные)

### 9.1. Функциональные критерии
- [x] Все API endpoints работают согласно спецификации
- [x] WebSocket соединение устанавливается и работает
- [x] Отправка/получение текстовых сообщений работает
- [x] Отправка/отображение изображений работает
- [x] Удаление сообщений синхронизируется между клиентами
- [x] История переписки загружается и отображается

### 9.2. Нефункциональные критерии
- [x] Система работает в локальной сети
- [x] Аутентификация через JWT работает
- [x] Интерфейс интуитивно понятен для базовых операций
- [x] Код соответствует стандартам PEP8

### 9.3. Критерии качества кода
- [x] Читаемый и документированный код
- [x] Логичная структура проекта
- [x] Отсутствие критических ошибок при обычном использовании
- [ ] Тесты не реализованы (учебный проект)

---

## 10. Процесс развертывания

### 10.1. Развертывание сервера
```bash
# 1. Установка Python 3.8+
# 2. Установка зависимостей
pip install fastapi uvicorn sqlite3 python-jose[cryptography] passlib[bcrypt] websockets

# 3. Копирование файлов сервера
# 4. Настройка config.py (IP сервера)
# 5. Инициализация базы данных
python -c "from database.db import init_db; init_db()"

# 6. Запуск сервера
uvicorn main:app --host 0.0.0.0 --port 8000
```

### 10.2. Развертывание клиента
```bash
# 1. Установка Python 3.8+
# 2. Установка зависимостей
pip install pyqt5 requests websockets

# 3. Копирование файлов клиента
# 4. Настройка config.py (IP сервера)
# 5. Запуск клиента
python main.py
```

### 10.3. Проверка работоспособности
```bash
# Проверка сервера
curl http://localhost:8000/docs

# Или в браузере: http://{server_ip}:8000/docs
```

---

**Разработал:**  
___________________________  
Малиневский Егор Сергеевич  
Студент группы 21ИС-24  
Дата: 19.01.2026

**Приемка:**  
___________________________  
Бобошко Михаил Николаевич
Должность: Преподаватель 
Дата: ___________________

---

**Версия документа:** 1.0 (фактическая)  
**Статус:** Точно соответствует реализованному проекту

*Техническое задание описывает фактически реализованную систему "Локальный мессенджер". Все технические решения соответствуют коду проекта.*
